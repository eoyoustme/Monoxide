---====== Load spawner ======---

local spawner = loadstring(game:HttpGet("https://raw.githubusercontent.com/RegularVynixu/Utilities/main/Doors/Entity%20Spawner/V2/Source.lua"))()

---====== Create entity ======---

local entity = spawner.Create({
	Entity = {
		Name = "A-200",
		Asset = "rbxassetid://129659469594085",
		HeightOffset = 0
	},
	Lights = {
		Flicker = {
			Enabled = false,
			Duration = 1
		},
		Shatter = true,
		Repair = false
	},
	Earthquake = {
		Enabled = false
	},
	CameraShake = {
		Enabled = true,
		Range = 100,
		Values = {1.5, 20, 0.1, 1}
	},
	Movement = {
		Speed = 60,
		Delay = 2,
		Reversed = true
	},
	Rebounding = {
		Enabled = true,
		Type = "Ambush",
		Min = 2,
		Max = 3,
		Delay = 2
	},
	Damage = {
		Enabled = true,
		Range = 20,
		Amount = 125
	},
	Crucifixion = {
		Enabled = true,
		Range = 40,
		Resist = false,
		Break = true
	},
	Death = {
		Type = "Guiding",
		Hints = {"You die to A-200", "He like A-120 But easy", "If you hear him sound", "HIDE Remember this"},
		Cause = ""
	}
})

---====== Behavior callbacks ======---

entity:SetCallback("OnSpawned", function()
	print("Entity has spawned")

	-- Tạo sương mù
	local lighting = game:GetService("Lighting")
	local atmosphere = Instance.new("Atmosphere")
	atmosphere.Name = "A200Fog"
	atmosphere.Density = 1
	atmosphere.Offset = 0.2
	atmosphere.Color = Color3.fromRGB(200, 0, 0)
	atmosphere.Decay = Color3.fromRGB(100, 0, 0)
	atmosphere.Parent = lighting
end)

entity:SetCallback("OnStartMoving", function()
	print("Entity has started moving")

	local Players = game:GetService("Players")
	local RunService = game:GetService("RunService")

	-- Bắt đầu kiểm tra xem người chơi có đang núp không
	local connection
	connection = RunService.Heartbeat:Connect(function()
		for _, player in pairs(Players:GetPlayers()) do
			local character = player.Character
			if character and character:FindFirstChild("HumanoidRootPart") then
				local isHiding = false

				if character:FindFirstChild("Hiding") or player:GetAttribute("Hidden") == true then
					isHiding = true
				end

				if isHiding then
					print(player.Name .. " is hiding, entity ignores them")
					-- Có thể xử lý logic bỏ qua đuổi theo nếu cần
				else
					print(player.Name .. " is not hiding, chasing")
					-- Logic đuổi theo nếu cần thêm
				end
			end
		end
	end)

	entity:SetCallback("OnDespawned", function()
		print("Entity has despawned")
		
		-- Xóa sương mù khi biến mất
		local lighting = game:GetService("Lighting")
		local fog = lighting:FindFirstChild("A200Fog")
		if fog then
			fog:Destroy()
		end

		if connection then connection:Disconnect() end
	end)
end)

entity:SetCallback("OnDamagePlayer", function(newHealth)
	if newHealth == 0 then
		print("Entity has killed the player")
	else
		print("Entity has damaged the player")

		-- Âm thanh
		local cue2 = Instance.new("Sound")
		cue2.Parent = game.Workspace
		cue2.Name = "Spawn"
		cue2.SoundId = "rbxassetid://912345678" -- Thay bằng ID âm thanh hợp lệ
		cue2.Volume = 4.5
		cue2.PlaybackSpeed = 2
		cue2:Play()

		-- GUI jumpscare
		local player = game.Players.LocalPlayer
		local character = player.Character or player.CharacterAdded:Wait()
		local playerGui = player:WaitForChild("PlayerGui")

		local screenGui = Instance.new("ScreenGui")
		screenGui.Name = "RandomImageGui"
		screenGui.IgnoreGuiInset = true
		screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
		screenGui.Parent = playerGui

		local Background = Instance.new("Frame")
		Background.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
		Background.BorderSizePixel = 0
		Background.Size = UDim2.new(1, 0, 1, 0)
		Background.ZIndex = 999
		Background.BackgroundTransparency = 1
		Background.Parent = screenGui

		local imageIds = {
			"16249498432",
			"16249498432",
			"16249498432"
		}

		local function getRandomImageId()
			return imageIds[math.random(1, #imageIds)]
		end

		local imageLabel = Instance.new("ImageLabel")
		imageLabel.Size = UDim2.new(0, 0, 0, 0)
		imageLabel.AnchorPoint = Vector2.new(0.5, 0.5)
		imageLabel.Position = UDim2.new(0.5, 0, 0.5, 0)
		imageLabel.BackgroundTransparency = 1
		imageLabel.Image = "rbxassetid://" .. getRandomImageId()
		imageLabel.ImageTransparency = 1
		imageLabel.Parent = screenGui

		local TweenService = game:GetService("TweenService")
		local appearTween = TweenService:Create(imageLabel, TweenInfo.new(0.1), {
			Size = UDim2.new(0, 580, 0, 580),
			ImageTransparency = 0
		})
		local rotateTween = TweenService:Create(imageLabel, TweenInfo.new(0.1), {
			Rotation = math.random(10, 18)
		})

		appearTween:Play()
		wait(0.2)
		rotateTween:Play()
		wait(0.8)

		TweenService:Create(Background, TweenInfo.new(2), {BackgroundTransparency = 1}):Play()
		TweenService:Create(imageLabel, TweenInfo.new(1.5), {ImageTransparency = 1}):Play()

		task.wait(3)
		screenGui:Destroy()

		if character:FindFirstChild("Humanoid") then
			character.Humanoid.Health -= 10
		end

		local stats = game.ReplicatedStorage:FindFirstChild("GameStats")
		if stats and stats:FindFirstChild("Player_" .. player.Name) then
			stats["Player_" .. player.Name].Total.DeathCause.Value = "A-200"
		end
	end
end)

---====== Run entity ======---

entity:Run()
