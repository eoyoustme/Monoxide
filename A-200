--====== Load spawner ======--

local spawner = loadstring(game:HttpGet("https://raw.githubusercontent.com/RegularVynixu/Utilities/main/Doors/Entity%20Spawner/V2/Source.lua"))()

--====== Create entity ======--

local entity = spawner.Create({
	Entity = {
		Name = "A-200",
		Asset = "rbxassetid://129659469594085",
		HeightOffset = 0
	},
	Lights = {
		Flicker = {
			Enabled = false,
			Duration = 1
		},
		Shatter = true,
		Repair = false
	},
	Earthquake = {
		Enabled = false
	},
	CameraShake = {
		Enabled = true,
		Range = 100,
		Values = {1.5, 20, 0.1, 1}
	},
	Movement = {
		Speed = 60,
		Delay = 2,
		Reversed = true
	},
	Rebounding = {
		Enabled = true,
		Type = "Ambush",
		Min = 2,
		Max = 3,
		Delay = 2
	},
	Damage = {
		Enabled = true,
		Range = 20,
		Amount = 125
	},
	Crucifixion = {
		Enabled = true,
		Range = 40,
		Resist = false,
		Break = true
	},
	Death = {
		Type = "Guiding",
		Hints = {"You die to A-200", "He like A-120 but easier", "If you hear his sound", "HIDE! Remember this"},
		Cause = ""
	}
})

--====== Di chuyển đuổi theo người chơi khi không núp ======--

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local chaseConnection

entity:SetCallback("OnSpawned", function()
	print("Entity has spawned")

	-- Tạo sương mù
	local atmosphere = Instance.new("Atmosphere")
	atmosphere.Name = "A200Fog"
	atmosphere.Density = 1
	atmosphere.Offset = 0.2
	atmosphere.Color = Color3.fromRGB(255, 255, 255)
	atmosphere.Decay = Color3.fromRGB(255, 255, 255)
	atmosphere.Parent = game:GetService("Lighting")
end)

entity:SetCallback("OnStartMoving", function()
	print("Entity has started moving")

	chaseConnection = RunService.Heartbeat:Connect(function(dt)
		local player = Players.LocalPlayer
		if not player then return end

		local char = player.Character
		if char and char:FindFirstChild("HumanoidRootPart") then
			local isHiding = char:FindFirstChild("Hiding") or player:GetAttribute("Hidden") == true

			if not isHiding then
				local model = entity.Model
				if model and model.PrimaryPart then
					local targetPos = char.HumanoidRootPart.Position
					local currentPos = model.PrimaryPart.Position
					local direction = (targetPos - currentPos)

					if direction.Magnitude > 1 then
						direction = direction.Unit
						local move = direction * entity.Config.Movement.Speed * dt
						model:SetPrimaryPartCFrame(CFrame.new(currentPos + move, targetPos))
					end
				end
			end
		end
	end)
end)

entity:SetCallback("OnDespawned", function()
	print("Entity has despawned")

	local fog = game:GetService("Lighting"):FindFirstChild("A200Fog")
	if fog then fog:Destroy() end

	if chaseConnection then
		chaseConnection:Disconnect()
		chaseConnection = nil
	end
end)

--====== Jumpscare khi giết người chơi ======--

entity:SetCallback("OnDamagePlayer", function(newHealth)
	if newHealth == 0 then
		print("Entity has killed the player")

		local player = game.Players.LocalPlayer
		local character = player.Character or player.CharacterAdded:Wait()
		local playerGui = player:WaitForChild("PlayerGui")

		local screenGui = Instance.new("ScreenGui")
		screenGui.Name = "DeathJumpscareGui"
		screenGui.IgnoreGuiInset = true
		screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
		screenGui.Parent = playerGui

		local background = Instance.new("Frame")
		background.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
		background.BorderSizePixel = 0
		background.Size = UDim2.new(1, 0, 1, 0)
		background.ZIndex = 999
		background.BackgroundTransparency = 1
		background.Parent = screenGui

		local imageLabel = Instance.new("ImageLabel")
		imageLabel.Size = UDim2.new(0, 700, 0, 700)
		imageLabel.AnchorPoint = Vector2.new(0.5, 0.5)
		imageLabel.Position = UDim2.new(0.5, 0, 0.5, 0)
		imageLabel.BackgroundTransparency = 1
		imageLabel.Image = "rbxassetid://16249498432"
		imageLabel.ImageTransparency = 0
		imageLabel.ZIndex = 1000
		imageLabel.Parent = screenGui

		local sound = Instance.new("Sound")
		sound.SoundId = "rbxassetid://85271883712040"
		sound.Volume = 6
		sound.PlaybackSpeed = 2 -- âm thanh nhanh hơn
		sound.Parent = playerGui
		sound:Play()

		task.wait(2)
		screenGui:Destroy()

		if character:FindFirstChild("Humanoid") then
			character.Humanoid.Health = 0
		end

		local stats = game.ReplicatedStorage:FindFirstChild("GameStats")
		if stats and stats:FindFirstChild("Player_" .. player.Name) then
			stats["Player_" .. player.Name].Total.DeathCause.Value = "A-200"
		end
	else
		print("Entity has damaged the player")
	end
end)

--====== Run entity ======--

entity:Run()
